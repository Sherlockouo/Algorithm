链接：[HDU 6211 Pythagoras](http://acm.hdu.edu.cn/showproblem.php?pid=6211)
$$
 x^2+y^2=z^2  \ \ \ \ \ \ \  (1<=x<y<z<=10^9) \\
 gcd(x,y) = 1, gcd(x,z)=1, gcd(y,z)=1\\
 $$
给定数组 $a[0...2^k-1]$ 对于所有满足条件的 $y$，求 $\sum_{i=y \mod 2^k}^{} a[i]$。$(1<=k<=17)$

* 题解：根据勾股定理：$x = \sqrt {z^2 - y^2} = \sqrt{(z-y)(z+y)}$，令 $z-y= s^2, z+y = t^2$，则有：
$$x = st$$ $$y=\frac {t^2-s^2} {2} $$ $$ z = \frac{t^2+s^2}{2}$$
满足以下几个关系：
* 1）$1 <= s < t < \sqrt {2*10^9 - 1}$；
证明：根据上图中的  $y > 1$ 得出 $s < t$；根据 $z <= 10^9$，得到 $t < \sqrt {2*10^9 - 1}$；
* 2）$s$ 和 $t$ 一定互素；
证明：假设 $s$ 和 $t$ 不互素，那么 $s = as'$，$t=at'$ $(a>1)$，由此推导出：$y=\frac {a^2(t'^2-s'^2)} {2}$, $z=\frac {a^2(t'^2+s'^2)} {2}$，那么，无论 $a$ 是不是 $2$ 的倍数，$y$ 和 $z$ 至少有一个公因子 $a$， 所以只有当 $a=1$ 才满足题目要求，所以  $s$ 和 $t$ 一定互素；

* 3）$y = \frac {t^2-s^2} {2}$ 或者 $st$；
证明：$st$ 和 $\frac {t^2-s^2} {2}$ 之间没有绝对的大小关系，可以利用二次函数求根公式得出，所以当 $st < \frac {t^2-s^2} {2}$时，$y = \frac {t^2-s^2} {2}$；$st > \frac {t^2-s^2} {2}$时，$y = st$；
* 4）$s$ 和 $t$ 奇偶性一定相同；
证明：假设 $s$ 为奇数， $t$ 为偶数，那么他们的平方差一定会奇数，不能被 $2$ 整除，所以 $s$ 和 $t$ 一定同奇偶；
* 5）$t$ 一定是奇数；
证明：如若 $t$ 为偶数，那么根据第4）条，$s$ 也一定是偶数，那么 $gcd(s,t)$ 至少为 $2$， 和 2）矛盾；所以 $t$ 和 $s$ 一定同时为奇数；

**算法实现**
* 1）预处理
* 枚举 $t = 1$ $to$ $\sqrt {2*10^9-1}$，步长 $2$；
* * 枚举 $s=1$ $to$ $t-2$，步长 $2$；
* * * 判断 $s$ 和 $t$ 互素后计算 $x、y、z$，确保 $z$ 不会超过 $10^9$；
* * * * 取 $x、y$ 中的大者记录在数组 $A$ 中：  $A[y \mod 2^{17}]  = A[y \mod 2^{17}]  + 1$；
* 2）数据恢复
![在这里插入图片描述](https://img-blog.csdnimg.cn/20201120072348585.png#pic_center)
* 在下标映射的时候，**对 2 的高次幂取模，再对 2 的低次幂取模** 和 **直接对 2 的低次幂取模** 的效果是一样的，所以可以把数据全部预先存储在一个 $A[2^{17}]$ 的数组中，当实际用到的时候再进行下标重映射；这样就不需要存 $17 * 2^{17}$ 份数据了；
**优化点**
*·1）由于 $s$ 和 $t$ 均为奇数，所以 $s$ 可以从 $1$ 开始枚举，$t$ 可以从 $3$ 开始枚举，而且步长可以设为 2，减少无效枚举；
* 2）所有 $s$、$t$ 的 平方 可以预先计算出来存储到一个数组中，避免重复计算；
* 3）判断 $s$ 和 $t$ 是否互素，可以先将 $t$ 进行因式分解，然后逐个判断 $s$ 中有没有 $t$ 的素因子，会比求 $gcd$ 高效；
* 4）计算 $z$ 的时候除 $2$ 操作用位运算 $>>= 1$；
* 5）取模 $2$ 的 $k$ 次 采用 & ((1<<k) - 1)；
